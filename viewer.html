<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Image & JSON Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; margin: 0; height: 100vh; background-color: #f4f4f4; }
        #sidebar { width: 280px; background-color: #fff; border-right: 1px solid #ddd; padding: 15px; overflow-y: auto; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        #sidebar h2 { margin-top: 0; font-size: 1.2em; color: #333; }
        #sidebar ul { list-style-type: none; padding: 0; margin: 0; }
        #sidebar li { padding: 10px 12px; cursor: pointer; border-radius: 4px; margin-bottom: 5px; transition: background-color 0.2s; }
        #sidebar li:hover { background-color: #e9e9e9; }
        #sidebar li.active { background-color: #007bff; color: white; font-weight: bold; }
        #content-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center;}
        #viewer-container { width: 90%; max-width: 1200px; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        #current-file-title { text-align: center; font-size: 1.5em; color: #333; margin-bottom: 20px; }
        #image-display { display: block; max-width: 100%; max-height: 60vh; margin: 0 auto 20px auto; border: 1px solid #ddd; border-radius: 4px; object-fit: contain; }
        #json-title { font-size: 1.2em; color: #333; margin-top: 20px; margin-bottom: 10px; }
        #json-display { white-space: pre-wrap; word-wrap: break-word; background-color: #282c34; color: #abb2bf; border: 1px solid #ddd; padding: 15px; border-radius: 4px; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; max-height: 400px; overflow-y: auto;}
        .hidden { display: none !important; }
        .error-message { color: red; text-align: center; }
    </style>
</head>
<body>
    <nav id="sidebar">
        <h2>Files</h2>
        <ul id="navigation-ul">
            </ul>
    </nav>
    <main id="content-area">
        <div id="viewer-container">
            <h1 id="current-file-title">Select a file from the list</h1>
            <img id="image-display" src="#" alt="Selected Image" class="hidden">
            <h2 id="json-title" class="hidden">JSON Content:</h2>
            <pre id="json-display" class="hidden">{}</pre>
        </div>
    </main>

    <script>
        const navUl = document.getElementById('navigation-ul');
        const imageDisplay = document.getElementById('image-display');
        const jsonDisplay = document.getElementById('json-display');
        const jsonTitle = document.getElementById('json-title');
        const currentFileTitle = document.getElementById('current-file-title');
        let currentFilesManifest = [];

        async function loadManifestAndDisplayFiles() {
            try {
                const response = await fetch('file_manifest.json?cachebust=' + new Date().getTime()); // Cache busting
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} while fetching manifest.`);
                }
                currentFilesManifest = await response.json();
                populateFileList(currentFilesManifest);
            } catch (error) {
                console.error("Could not load file manifest:", error);
                navUl.innerHTML = `<li class="error-message">Error loading file list. <br>1. Run generate_manifest.py. <br>2. Ensure you're using a local web server. <br><small>${error.message}</small></li>`;
            }
        }

        function populateFileList(files) {
            navUl.innerHTML = ''; // Clear existing list
            if (!files || files.length === 0) {
                navUl.innerHTML = '<li>No image/JSON pairs found in manifest. Run generate_manifest.py.</li>';
                return;
            }
            files.forEach((filePair) => {
                const listItem = document.createElement('li');
                listItem.textContent = filePair.name;
                listItem.title = `Image: ${filePair.imagePath}\nJSON: ${filePair.jsonPath || 'N/A'}`;
                listItem.onclick = (event) => loadContent(filePair, event.currentTarget);
                navUl.appendChild(listItem);
            });
        }

        async function loadContent(filePair, listItemElement) {
            // Highlight active item
            document.querySelectorAll('#navigation-ul li').forEach(li => li.classList.remove('active'));
            if(listItemElement) listItemElement.classList.add('active');

            currentFileTitle.textContent = filePair.name;

            // Display image
            imageDisplay.src = filePair.imagePath;
            imageDisplay.alt = `Image: ${filePair.name}`;
            imageDisplay.classList.remove('hidden');

            // Fetch and display JSON (if path exists)
            if (filePair.jsonPath) {
                try {
                    const response = await fetch(filePair.jsonPath + '?cachebust=' + new Date().getTime()); // Cache busting
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const jsonData = await response.json();
                    jsonDisplay.textContent = JSON.stringify(jsonData, null, 2); // Pretty print
                    jsonDisplay.classList.remove('hidden');
                    jsonTitle.classList.remove('hidden');
                } catch (error) {
                    console.error(`Could not load JSON file "${filePair.jsonPath}":`, error);
                    jsonDisplay.textContent = `Error loading JSON for ${filePair.name}:\n${error.message}`;
                    jsonDisplay.classList.remove('hidden');
                    jsonTitle.classList.remove('hidden');
                }
            } else {
                jsonDisplay.textContent = "No JSON file associated with this image.";
                jsonDisplay.classList.remove('hidden');
                jsonTitle.classList.remove('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', loadManifestAndDisplayFiles);
    </script>
</body>
</html>
